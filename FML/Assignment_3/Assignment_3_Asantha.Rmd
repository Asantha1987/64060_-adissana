---
title: "Assignment_3_FML_Asantha"
author: "Asantha"
output: html_document
date: "2025-10-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


#Q-A: Data Preparation and Pivot Table Creation

```{r}
# Import Data and Prepare Training & Validation Sets

# Load required libraries
library(dplyr)
library(reshape2)
library(e1071)  # For Naive Bayes model

# Import dataset using local file path
bank <- read.csv("C:\\Users\\12165\\Downloads\\UniversalBank.csv")

# Split data: 60% training, 40% validation
set.seed(1)
train_index <- sample(1:nrow(bank), 0.6 * nrow(bank))
train_set <- bank[train_index, ]
valid_set <- bank[-train_index, ]

# Generate 3D pivot table: CreditCard × Personal.Loan × Online
pivot_tbl <- table(train_set$CreditCard, train_set$Personal.Loan, train_set$Online)

# Extract matrices for Online = 0 and Online = 1
pivot_offline <- as.matrix(pivot_tbl[, , "0"])
pivot_online <- as.matrix(pivot_tbl[, , "1"])

# Save main pivot for later reference
pivot_data <- pivot_tbl

# Display pivot tables
cat("Pivot table (Online = 0):\n")
print(pivot_offline)
cat("\nPivot table (Online = 1):\n")
print(pivot_online)

# Interpretation:
# The dataset was imported from a local path and divided into training and validation sets.
# A 3D pivot table summarizes the distribution of credit card holders, loan takers,
# and online users. Each slice (Online = 0 or 1) helps visualize how these categories interact.

```



#Q-B: Conditional Probability from Pivot Table

```{r}
# Extract relevant counts for CC=1 and Online=1
cc1_online1_loan0 <- pivot_data["1", "0", "1"]
cc1_online1_loan1 <- pivot_data["1", "1", "1"]

# Compute conditional probability
prob_loan_given_cc_online <- cc1_online1_loan1 / (cc1_online1_loan0 + cc1_online1_loan1)
prob_loan_given_cc_online

# Interpretation:
# This probability measures how likely customers with both a credit card and online banking
# are to accept a personal loan. It helps reveal the connection between these attributes.

```


#Q-C: Pivot Tables for Loan vs Online and Loan vs Credit Card


```{r}
# Reload and rebuild training data if not already available
if (!exists("train_set")) {
  bank <- read.csv("C:\\Users\\12165\\Downloads\\UniversalBank.csv")
  set.seed(1)
  train_index <- sample(1:nrow(bank), 0.6 * nrow(bank))
  train_set <- bank[train_index, ]
}

# Pivot table: Loan vs Online
pivot_loan_online <- table(train_set$Personal.Loan, train_set$Online)
pivot_loan_online

# Pivot table: Loan vs CreditCard
pivot_loan_card <- table(train_set$Personal.Loan, train_set$CreditCard)
pivot_loan_card

# Interpretation:
# Separate pivot tables show how loan acceptance correlates individually
# with online banking and credit card ownership.
# These relationships highlight which features may better predict loan acceptance
# before building the Naive Bayes model.

```


#Q-D: Compute Basic Probabilities

```{r}
# Convert variables to binary indicators
train_set$CreditCard_bin <- ifelse(train_set$CreditCard > 0, 1, 0)
train_set$Online_bin <- ifelse(train_set$Online > 0, 1, 0)

# Split by loan status
loan_yes <- train_set[train_set$Personal.Loan == 1, ]
loan_no <- train_set[train_set$Personal.Loan == 0, ]

# Compute conditional probabilities
p_cc_loan1 <- mean(loan_yes$CreditCard_bin)
p_online_loan1 <- mean(loan_yes$Online_bin)
p_loan1 <- mean(train_set$Personal.Loan)

p_cc_loan0 <- mean(loan_no$CreditCard_bin)
p_online_loan0 <- mean(loan_no$Online_bin)
p_loan0 <- 1 - p_loan1

# Print all probabilities
list(
  P_CC_given_Loan1 = p_cc_loan1,
  P_Online_given_Loan1 = p_online_loan1,
  P_Loan1 = p_loan1,
  P_CC_given_Loan0 = p_cc_loan0,
  P_Online_given_Loan0 = p_online_loan0,
  P_Loan0 = p_loan0
)

# Interpretation:
# These probabilities summarize how credit card ownership and online banking
# differ between loan acceptors and non-acceptors.
# They serve as essential inputs for the Naive Bayes probability calculations.

```

#Q-E: Naive Bayes Probability Estimation

```{r}
# Use probabilities from Step D
p_cc_loan1 <- p_cc_loan1
p_online_loan1 <- p_online_loan1
p_loan1 <- p_loan1

# Compute marginal probabilities
p_cc1 <- mean(train_set$CreditCard_bin)
p_online1 <- mean(train_set$Online_bin)

# Apply Naive Bayes formula
nb_prob <- (p_cc_loan1 * p_online_loan1 * p_loan1) / (p_cc1 * p_online1)
nb_prob

# Interpretation:
# The Naive Bayes formula estimates the probability that a customer
# with a credit card and online banking will accept a personal loan.
# The result is compared to the pivot-based probability
# to validate the independence assumption between predictors.

```


#Q-F: Compare Probabilities


```{r}
# Ensure the probability from Step B exists
if (!exists("prob_loan_given_cc_online")) {
  # Recalculate if missing
  if (!exists("pivot_tbl")) {
    bank <- read.csv("C:\\Users\\12165\\Downloads\\UniversalBank.csv")
    set.seed(1)
    train_index <- sample(1:nrow(bank), 0.6 * nrow(bank))
    train_set <- bank[train_index, ]
    pivot_tbl <- table(train_set$CreditCard, train_set$Personal.Loan, train_set$Online)
  }
  
  # Compute conditional probability again
  cc1_online1_loan0 <- pivot_tbl["1", "0", "1"]
  cc1_online1_loan1 <- pivot_tbl["1", "1", "1"]
  prob_loan_given_cc_online <- cc1_online1_loan1 / (cc1_online1_loan0 + cc1_online1_loan1)
}

# Display comparison
cat("Pivot Table Probability =", prob_loan_given_cc_online, "\n")
cat("Naive Bayes Estimate =", nb_prob, "\n")

# Interpretation:
# This comparison shows how closely the Naive Bayes estimate matches
# the observed (pivot table) probability for customers with both credit cards
# and online banking access.
# A small difference between the two indicates that the model fits the data well
# and that the independence assumption between predictors is reasonable.

```


#Q-G: Extract Key Counts and Model Validation


```{r}
# Rebuild binary variables
train_set$CreditCard_bin <- ifelse(train_set$CreditCard > 0, 1, 0)
train_set$Online_bin <- ifelse(train_set$Online > 0, 1, 0)

# Create 3D pivot table
pivot_tbl <- table(train_set$CreditCard_bin, train_set$Personal.Loan, train_set$Online_bin)

# Empirical probability from pivot
numerator <- pivot_tbl["1", "1", "1"]
denominator <- pivot_tbl["1", "0", "1"] + pivot_tbl["1", "1", "1"]
empirical_prob <- numerator / denominator
cat("Empirical P(Loan=1 | CC=1, Online=1):", empirical_prob, "\n")

# Train Naive Bayes model
train_set$Personal.Loan <- as.factor(train_set$Personal.Loan)
nb_model <- naiveBayes(Personal.Loan ~ CreditCard_bin + Online_bin, data = train_set)

# Predict for new case: CC=1, Online=1
test_case <- data.frame(CreditCard_bin = 1, Online_bin = 1)
pred_probs <- predict(nb_model, test_case, type = "raw")

cat("Model P(Loan=0 | CC=1, Online=1):", pred_probs[1, "0"], "\n")
cat("Model P(Loan=1 | CC=1, Online=1):", pred_probs[1, "1"], "\n")

# Calculate NB formula manually
p_cc_loan1 <- mean(train_set$CreditCard_bin[train_set$Personal.Loan == 1])
p_online_loan1 <- mean(train_set$Online_bin[train_set$Personal.Loan == 1])
p_loan1 <- mean(as.numeric(as.character(train_set$Personal.Loan)))

p_cc1 <- mean(train_set$CreditCard_bin)
p_online1 <- mean(train_set$Online_bin)

nb_prob_formula <- (p_cc_loan1 * p_online_loan1 * p_loan1) / (p_cc1 * p_online1)
cat("Naive Bayes formula P(Loan=1 | CC=1, Online=1):", nb_prob_formula, "\n")

# Interpretation:
# The pivot-based and model-based probabilities are nearly identical,
# confirming that the Naive Bayes model accurately captures
# the conditional relationships in the dataset.
# This consistency indicates the model’s assumptions are valid
# for these selected predictors.

```


```{r}
# Conclusion

# Interpretation Summary:
# In this assignment, data from UniversalBank was analyzed to study how
# credit card ownership and online banking usage influence personal loan acceptance.
# 
# The pivot tables provided a visual understanding of how these factors
# relate to each other, while the Naive Bayes approach quantified
# the conditional probabilities.
# 
# The probability of a customer accepting a loan given both a credit card
# and online banking (P(Loan=1 | CC=1, Online=1)) was found to be
# very similar when calculated directly from data and when estimated
# using the Naive Bayes formula.
# 
# This close match validates the Naive Bayes independence assumption
# for these predictors and demonstrates that both credit card ownership
# and online banking behavior are relevant indicators of loan acceptance.
# 
# Overall, the results confirm that simple probabilistic models like Naive Bayes
# can effectively estimate customer behavior when features show moderate independence.

```



